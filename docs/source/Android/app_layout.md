# Макеты элементов пользовательского интерфейса (Layout)

Одной из проблем при разработки приложения является адаптация элементов экрана (пользовательского интерфейса) под устройства с разными характеристиками экранов. 

![1760496730343](image/app_layout/1760496730343.png)

**Рис. 1.** Различные размеры экранов устройств Android.

## Density-independent pixel (dp)

Относительный параметр (**не зависящий от плотности экрана пиксель**) был введен во избежании проблем с компановкой элементов внутри разного размера экранов пользовательского оборудования.

![1760497331837](image/app_layout/1760497331837.png)

**Рис. 2.** Размеры ширины и высоты `TextView` в `dp`.

Данный параметр учитывает плотность пикселей (`Pixel per Inch` - `PPI`) экрана или `screen density`.
Все Android-виджеты измеряются в относительных величинах (`dp`). 

$$
dp = \frac{width_{pixels} * 160}{density_{screen}}
$$

- `160` - средняя плотность пикселей (**baseline density**);
- `width_pixels` - ширина экрана, например **1920x800**, 800 - ширина;
- `density_screen` - плотность пикселей.


Alternatively, using the math directive:
````{math}
a^2 + b^2 = c^2
````

Alternatively, using the math directive:
````{math}
dp = \frac{width_{pixels} * 160}{density_{screen}}
````



![1760497657503](image/app_layout/1760497657503.png)

**Рис. 3.** Наглядный пример отображения плотности пикселей (`PPI`).

![1760500976124](image/app_layout/1760500976124.png)

**Рис. 4.** Пример одинакового размера экрана, но разной плотностью пикселей.

Чтобы обеспечить хорошее качество изображений на устройствах с разной плотностью пикселей, предоставьте в приложении **несколько** версий каждого растрового изображения — по одной для каждого диапазона плотности с соответствующим разрешением. В противном случае `Android` придётся масштабировать растровое изображение так, чтобы оно занимало одинаковое видимое пространство на каждом экране, что приведёт **к появлению артефактов масштабирования**, таких как **размытие**.

**Таблица. 1.** Разделение на группы по параметру `DPI`.
| Density qualifier     | DPI estimate [`dpi`]      | Description                       |
| --------              | -------                   | -------                           |
| `ldpi`                | ~120                      |   low-density                     |
| `mdpi`                | ~160                      |   medium-density (`baseline`)     |
| `hdpi`                | ~240                      |   high-density                    |
| `xhdpi`               | ~320                      |   extra-high-density              |
| `xxhdpi`              | ~480                      |   extra-extra-high-density        |
| `xxxhdpi`             | ~640                      |   extra-extra-extra-high-density  |
| `nodpi`               | -                         |   Не зависят от плотности.        |

Ниже показан пример нескольких версий растрового изображения.

![1760508822835](image/app_layout/1760508822835.png)

**Рис. 5.** Несколько изображений под каждую группу `DPI`.

В ресурсах проекта (директория `res/`) файлы должны находится в своих `dpi`-группах:
```xml
res/
  drawable-xxxhdpi/
    awesome_image.png
  drawable-xxhdpi/
    awesome_image.png
  drawable-xhdpi/
    awesome_image.png
  drawable-hdpi/
    awesome_image.png
  drawable-mdpi/
    awesome_image.png
```

## Процесс отображения (Rendering) виджетов

Перед тем как `Android`-приложение покажет вам свое первое `Activity`, выполняется еще несколько основных функций\методов работы с изображением:

1. `Measure` - вычисление точного местоположения каждого виджета на экране;
2. `Layout` - выравнивание виджетов относительно "макета\компановки" (`layout manager`);
3. `Draw` - отрисовка\рендер изображения. 

![1760509581710](image/app_layout/1760509581710.png)

**Рис. 6.** Android View rendering cycle.

